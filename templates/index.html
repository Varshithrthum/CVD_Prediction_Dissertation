<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVD Risk Predictor</title>
    <link rel="stylesheet" href="static/style.css"> <!-- Link to the external CSS -->
</head>
<body>
    <div class="container">
        <h1>CVD Risk Prediction Tool</h1>
        <form id="cvdForm" action="/predict" method="POST">
            <!-- Age -->
            <div class="form-group">
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" min="30" max="65" required>
            </div>

            <!-- Gender Radio Buttons -->
            <div class="form-group">
                <label for="gender">Gender:</label>
                <div class="radio-group">
                    <label><input type="radio" id="female" name="gender" value="0" required> Female</label>
                    <label><input type="radio" id="male" name="gender" value="1" required> Male</label>
                </div>
            </div>

            <!-- Height Toggle -->
            <div class="form-group">
                <label for="height">Height:</label>
                <span class="toggle-height" id="toggleHeight">Enter in feet and inches</span>

                <!-- Height in cm input (default) -->
                <div id="heightCmInput">
                    <input type="number" id="height_cm" name="height_cm" min="100" max="250" placeholder="Height in cm">
                </div>

                <!-- Height in feet and inches (hidden by default) -->
                <div id="heightFeetInchesInput" class="height-group" style="display: none;">
                    <input type="number" id="height_feet" name="height_feet" min="3" max="8" placeholder="Feet">
                    <label>feet</label>
                    <input type="number" id="height_inches" name="height_inches" min="0" max="11" placeholder="Inches">
                    <label>inches</label>
                </div>
            </div>

            <!-- Weight -->
            <div class="form-group">
                <label for="weight">Weight (kg):</label>
                <input type="number" id="weight" name="weight" min="30" max="200" required>
            </div>

            <!-- Systolic and Diastolic BP -->
            <div class="form-group">
                <label for="ap_hi">Systolic BP (ap_hi):</label>
                <input type="number" id="ap_hi" name="ap_hi" min="90" max="240" required>
            </div>

            <div class="form-group">
                <label for="ap_lo">Diastolic BP (ap_lo):</label>
                <input type="number" id="ap_lo" name="ap_lo" min="60" max="150" required>
            </div>

            <p class="info-text">If you don't know your blood pressure values, you can estimate them using the <a href="https://www.calcpark.com/blood-pressure-calculator" target="_blank">CalcPark Blood Pressure Calculator</a>. However, itâ€™s always best to consult a healthcare professional for accurate measurements and advice.</p>

            <!-- Smoking Radio Buttons -->
            <div class="form-group">
                <label for="smoke">Smoking:</label>
                <div class="radio-group">
                    <label><input type="radio" id="smoke_no" name="smoke" value="0" required> No</label>
                    <label><input type="radio" id="smoke_yes" name="smoke" value="1" required> Yes</label>
                </div>
            </div>

            <!-- Alcohol Intake Radio Buttons -->
            <div class="form-group">
                <label for="alco">Alcohol Intake:</label>
                <div class="radio-group">
                    <label><input type="radio" id="alco_no" name="alco" value="0" required> No</label>
                    <label><input type="radio" id="alco_yes" name="alco" value="1" required> Yes</label>
                </div>
            </div>

            <!-- Physical Activity Radio Buttons -->
            <div class="form-group">
                <label for="active">Physical Activity:</label>
                <div class="radio-group">
                    <label><input type="radio" id="active_no" name="active" value="0" required> No</label>
                    <label><input type="radio" id="active_yes" name="active" value="1" required> Yes</label>
                </div>
            </div>

            <!-- Cholesterol Section with Radio Buttons and Collapsible Info -->
            <div class="form-group">
                <label for="chol">Cholesterol:</label>
                <div class="radio-group">
                    <label><input type="radio" id="chol_normal" name="chol" value="1" required> Normal</label>
                    <label><input type="radio" id="chol_above_normal" name="chol" value="2" required> Above Normal</label>
                    <label><input type="radio" id="chol_well_above_normal" name="chol" value="3" required> Well Above Normal</label>
                </div>

                <button type="button" class="collapsible">Click here for More info about Cholesterol</button>
                <div class="content">
                    <div class="info-box">
                        <p><strong>Normal:</strong> Total cholesterol below 200 mg/dL, commonly found in individuals with a balanced diet, regular exercise, and no family history of heart disease.</p>
                        <p><strong>Above Normal:</strong> Total cholesterol between 200-239 mg/dL may be seen in people with a high-fat diet, limited physical activity, or obesity.</p>
                        <p><strong>Well Above Normal:</strong> Total cholesterol of 240 mg/dL or higher indicates high cholesterol, especially common in those with a family history of high cholesterol, poor diet, and sedentary lifestyle.</p>
                        <p class="info-text">Consult a healthcare provider to test your cholesterol levels for accuracy. <a href="https://www.nhs.uk/conditions/high-cholesterol/getting-tested/" target="_blank">Read more about cholesterol testing</a>.</p>
                    </div>
                </div>
            </div>

            <!-- Glucose Section with Radio Buttons and Collapsible Info -->
            <div class="form-group">
                <label for="gluc">Glucose:</label>
                <div class="radio-group">
                    <label><input type="radio" id="gluc_normal" name="gluc" value="1" required> Normal</label>
                    <label><input type="radio" id="gluc_above_normal" name="gluc" value="2" required> Above Normal</label>
                    <label><input type="radio" id="gluc_well_above_normal" name="gluc" value="3" required> Well Above Normal</label>
                </div>

                <button type="button" class="collapsible">Click here for More info about Glucose</button>
                <div class="content">
                    <div class="info-box">
                        <p><strong>Normal:</strong> Fasting glucose below 100 mg/dL, typical for those who maintain a healthy diet, exercise regularly, and have no family history of diabetes.</p>
                        <p><strong>Above Normal:</strong> Fasting glucose between 100-125 mg/dL indicates prediabetes, often linked to high sugar intake or a sedentary lifestyle.</p>
                        <p><strong>Well Above Normal:</strong> Fasting glucose of 126 mg/dL or higher suggests diabetes, often linked to poor diet, obesity, or a family history of diabetes.</p>
                        <p class="info-text">Consult a healthcare professional for proper glucose testing. <a href="https://www.nhs.uk/conditions/diabetes/diagnosis/" target="_blank">More information on glucose testing</a>.</p>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn">Predict</button>
        </form>

        {% if prediction %}
        <h2>Prediction Result: {{ prediction }}</h2>
        <img src="data:image/png;base64,{{ shap_plot_url }}" alt="SHAP Force Plot"/>
        {% endif %}
    </div>

    <script>
        // Collapsible functionality
        const collapsibles = document.querySelectorAll(".collapsible");

        collapsibles.forEach(button => {
            button.addEventListener("click", function() {
                this.classList.toggle("active");
                const content = this.nextElementSibling;
                if (content.style.display === "block") {
                    content.style.display = "none";
                } else {
                    content.style.display = "block";
                }
            });
        });

        // DOM elements for height inputs and form
        const toggleHeight = document.getElementById('toggleHeight');
        const heightCmInput = document.getElementById('heightCmInput');
        const heightFeetInchesInput = document.getElementById('heightFeetInchesInput');
        const heightCmField = document.getElementById('height_cm');
        const form = document.getElementById('cvdForm');

        let isCm = true;

        // Toggle between cm and feet/inches
        toggleHeight.addEventListener('click', function() {
            if (isCm) {
                heightCmInput.style.display = 'none';
                heightFeetInchesInput.style.display = 'flex';
                toggleHeight.textContent = 'Enter in centimeters';
                heightCmField.required = false;  // Disable cm field requirement
                isCm = false;
            } else {
                heightCmInput.style.display = 'block';
                heightFeetInchesInput.style.display = 'none';
                toggleHeight.textContent = 'Enter in feet and inches';
                heightCmField.required = true;  // Enable cm field requirement
                isCm = true;
            }
        });

        // Form submission event to handle height conversion
        form.addEventListener('submit', function(event) {
            if (!isCm) {
                const feet = parseFloat(document.getElementById('height_feet').value);
                const inches = parseFloat(document.getElementById('height_inches').value) || 0;

                if (isNaN(feet) || feet < 0 || inches < 0) {
                    alert("Please enter valid feet and inches values.");
                    event.preventDefault(); // Stop form submission
                    return;
                }

                // Convert feet and inches to cm
                const heightCm = (feet * 30.48) + (inches * 2.54);
                heightCmField.value = heightCm.toFixed(2);  
            }
        });
    </script>
</body>
</html>
